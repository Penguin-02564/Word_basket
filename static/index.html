<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Basket Online</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Home Screen -->
        <div id="home-screen" class="screen active">
            <header>
                <h1>Word Basket Online</h1>
            </header>
            <div class="home-content">
                <div class="home-buttons">
                    <button id="how-to-play-btn" class="home-btn">
                        📖 遊び方
                    </button>
                    <button id="single-play-btn" class="home-btn primary">
                        🎮 シングルプレイ
                    </button>
                    <button id="multi-play-btn" class="home-btn primary">
                        👥 マルチプレイ
                    </button>
                    <button id="settings-btn-home" class="home-btn">
                        ⚙️ 設定
                    </button>
                </div>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="screen">
            <header>
                <h1>ワードバスケット</h1>
            </header>
            <div class="lobby-content">
                <div class="lobby-actions">
                    <div class="action-box">
                        <h3>新しいルームを作成</h3>
                        <input type="text" id="host-name-input" placeholder="プレイヤー名を入力">

                        <!-- 特殊カード設定 -->
                        <div class="special-card-settings">
                            <h4>特殊カード設定</h4>
                            <div class="setting-row">
                                <label>
                                    <input type="checkbox" id="enable-special-cards" checked>
                                    特殊カード機能を有効にする
                                </label>
                            </div>
                            <div id="special-card-config" class="special-card-config">
                                <div class="setting-row">
                                    <label>プレイヤーあたりの枚数:</label>
                                    <input type="number" id="cards-per-player" min="0" max="5" value="2">
                                </div>
                                <div class="card-type-settings">
                                    <div class="card-type-item">
                                        <label>ドロー2:</label>
                                        <input type="number" id="draw2-count" min="0" max="10" value="3">
                                    </div>
                                    <div class="card-type-item">
                                        <label>ドロー3:</label>
                                        <input type="number" id="draw3-count" min="0" max="10" value="2">
                                    </div>
                                    <div class="card-type-item">
                                        <label>デュアルワード:</label>
                                        <input type="number" id="dual-word-count" min="0" max="10" value="3">
                                    </div>
                                    <div class="card-type-item">
                                        <label>ノーペナルティ:</label>
                                        <input type="number" id="no-penalty-count" min="0" max="10" value="6">
                                    </div>
                                    <div class="card-type-item">
                                        <label>ローテートスワップ:</label>
                                        <input type="number" id="rotate-swap-count" min="0" max="10" value="7">
                                    </div>
                                    <div class="card-type-item">
                                        <label>セレクトスワップ:</label>
                                        <input type="number" id="select-swap-count" min="0" max="10" value="4">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button id="create-room-btn" class="primary-btn">ルームを作成</button>
                    </div>

                    <div class="divider">または</div>

                    <div class="action-box">
                        <h3>既存のルームに参加</h3>
                        <input type="text" id="join-name-input" placeholder="プレイヤー名を入力">
                        <div class="join-input-group">
                            <input type="text" id="room-code-input" placeholder="ルームコード (4桁)" maxlength="4">
                            <button id="join-room-btn" class="primary-btn">参加</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Waiting Screen -->
        <div id="waiting-screen" class="screen">
            <header>
                <h1>待機中...</h1>
            </header>
            <div class="waiting-content">
                <div class="room-info">
                    <span class="label">ルームコード</span>
                    <div class="room-code-display" id="display-room-code">----</div>
                    <button id="copy-code-btn" class="icon-btn">📋</button>
                </div>

                <div class="players-list-container">
                    <h3>参加者リスト</h3>
                    <ul id="players-list" class="players-list">
                        <!-- Players will be added here -->
                    </ul>
                </div>

                <!-- Game Settings Display -->
                <div class="game-settings-display" id="game-settings-display">
                    <h4>ゲーム設定</h4>
                    <div id="settings-info" class="settings-info">
                        <!-- Settings will be displayed here -->
                    </div>
                </div>

                <div class="waiting-actions">
                    <button id="start-game-btn" class="primary-btn hidden">ゲーム開始</button>
                    <p id="waiting-message" class="message">ホストがゲームを開始するのを待っています...</p>
                    <button id="disconnect-waiting-btn" class="secondary-btn"
                        style="margin-top: 20px;">切断してタイトルに戻る</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <header>
                <button id="menu-btn" class="menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <h1>Word Basket</h1>
                <button id="disconnect-game-btn" class="secondary-btn">切断</button>
            </header>

            <!-- Game action buttons (moved outside header for grid layout) -->
            <div class="header-buttons">
                <button id="oppose-btn" class="danger-btn hidden">拒否</button>
                <button id="approve-btn" class="success-btn hidden">承諾</button>
                <button id="reroll-btn" class="secondary-btn">🔄 手札交換</button>
            </div>

            <div class="game-info">
                <!-- Opponents Area -->
                <div id="opponents-area" class="opponents-area">
                    <!-- Opponents info will be here -->
                </div>


                <div class="current-word-container">
                    <span class="label">現在の単語</span>
                    <div class="word-display" id="current-word">---</div>
                    <div id="special-card-badge" class="special-card-badge" style="display: none;"></div>
                    <div class="next-char-hint">次は <span id="target-char">?</span> から！</div>
                </div>

                <div class="status-panel">
                    <div class="status-item">
                        <span class="label">残り山札</span>
                        <span class="value" id="deck-count">--</span>
                    </div>
                    <div class="status-item">
                        <span class="label">場札の数</span>
                        <span class="value" id="discard-count">--</span>
                    </div>
                    <div class="status-item">
                        <span class="label">自分の手札</span>
                        <span class="value" id="hand-count">--</span>
                    </div>
                </div>
            </div>

            <div class="play-area">
                <div class="input-group">
                    <input type="text" id="word-input" placeholder="単語を入力 (ひらがな)" autocomplete="off">
                    <button id="submit-btn" class="primary-btn">決定</button>
                </div>
                <div id="message-area" class="message"></div>
            </div>

            <div class="hand-container">
                <div class="hand-label" id="hand-label">手札を選んでください</div>
                <div id="hand" class="hand">
                    <!-- Cards will be rendered here -->
                </div>
            </div>

            <!-- Special Cards Area -->
            <div class="special-cards-container">
                <div class="special-cards-header">
                    <span class="label">特殊カード</span>
                    <span class="count" id="special-cards-count">0/0</span>
                </div>
                <div id="special-cards" class="special-cards">
                    <!-- Special cards will be rendered here -->
                </div>
            </div>

            <!-- Voting Modal -->
            <div id="voting-modal" class="voting-modal hidden">
                <div class="voting-overlay"></div>
                <div class="voting-content">
                    <div class="voting-word-display">
                        <span id="voting-word"></span>
                    </div>
                    <div class="voting-message">この上がりを認めますか？</div>
                    <div class="voting-buttons">
                        <button id="vote-approve-btn" class="vote-btn vote-approve">承諾</button>
                        <button id="vote-reject-btn" class="vote-btn vote-reject">拒否</button>
                    </div>
                    <div class="voting-status" id="voting-status"></div>
                </div>
            </div>
        </div>
        <!-- Result Screen -->
        <div id="result-screen" class="screen">
            <header>
                <h1>ゲーム終了！</h1>
            </header>
            <div class="result-content">
                <div class="result-list-container">
                    <h3>順位発表</h3>
                    <ul id="result-list" class="result-list">
                        <!-- Results will be added here -->
                    </ul>
                </div>
                <div class="result-actions">
                    <button id="rematch-btn" class="primary-btn" style="display:none;">もう一度遊ぶ</button>
                    <button id="back-to-lobby-btn" class="primary-btn">ロビーに戻る</button>
                </div>
            </div>
        </div>
    </div>


    <!-- How to Play Modal -->
    <div id="how-to-play-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>遊び方</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <h3>ゲームの目的</h3>
                <p>7枚の手札を先に使い切ったプレイヤーが勝ちです。</p>

                <h3>基本ルール</h3>
                <ul>
                    <li>現在の単語の最後の文字から始まる単語を作ります</li>
                    <li>手札のカードと一致する条件を満たす単語を入力</li>
                    <li>「ん」で終わる単語は使えません</li>
                    <li>3文字以上の単語が必要（最後の1枚は4文字以上）</li>
                </ul>

                <h3>カードの種類</h3>
                <ul>
                    <li><strong>文字カード</strong>: その文字で終わる単語</li>
                    <li><strong>行カード</strong>: その行の文字で終わる単語（例: あ行 → あ、い、う、え、お）</li>
                    <li><strong>文字数カード</strong>: 指定の文字数の単語</li>
                </ul>

                <h3>特殊ルール</h3>
                <ul>
                    <li>長音「ー」で終わる場合、その前の文字の母音から始める</li>
                    <li>濁点・半濁点は元の文字として扱われます（例: 「ぐ」→「く」から）</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>設定</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>自動選択の優先順位</h3>
                    <p class="settings-description">ドラッグ＆ドロップで並び替えてください</p>
                    <div class="priority-list" id="priority-list">
                        <div class="priority-item" data-type="char">
                            <span class="drag-handle">☰</span>
                            <span class="priority-number">1</span>
                            <span class="priority-label">文字カード (あ, か...)</span>
                        </div>
                        <div class="priority-item" data-type="row">
                            <span class="drag-handle">☰</span>
                            <span class="priority-number">2</span>
                            <span class="priority-label">行カード (あ行, か行...)</span>
                        </div>
                        <div class="priority-item" data-type="length">
                            <span class="drag-handle">☰</span>
                            <span class="priority-number">3</span>
                            <span class="priority-label">文字数カード (3文字...)</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>表示設定</h3>
                    <div class="setting-item">
                        <label for="font-size-select">文字サイズ</label>
                        <select id="font-size-select">
                            <option value="small">小</option>
                            <option value="medium" selected>中</option>
                            <option value="large">大</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="compact-layout-toggle">
                            コンパクトレイアウト
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>その他</h3>
                    <div class="auto-select-toggle">
                        <label>
                            <input type="checkbox" id="auto-select-toggle">
                            入力時にカードを自動選択する
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hand Viewer Modal -->
    <div id="hand-viewer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="hand-viewer-player-name"></h2>
                <button class="close-btn" id="close-hand-viewer">&times;</button>
            </div>
            <div class="modal-body">
                <div id="viewed-hand" class="viewed-hand"></div>
            </div>
        </div>
    </div>

    <!-- Player Selection Modal (for Select Swap) -->
    <div id="player-selection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>交換相手を選択</h2>
                <button class="close-btn" id="close-player-selection">&times;</button>
            </div>
            <div class="modal-body">
                <div id="player-selection-list" class="player-selection-list">
                    <!-- Players will be added here -->
                </div>
                <div class="modal-actions">
                    <button id="cancel-player-selection-btn" class="secondary-btn">キャンセル</button>
                    <button id="confirm-player-selection-btn" class="primary-btn">決定</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="cards.js"></script>
    <script src="home.js"></script>
</body>

</html>